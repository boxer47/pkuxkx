#class hubiao open
#tab hb.start;
#tab hb.stop;

#var hb_max_path_size 45;
#var hb_auto 0;
#var hb_rotate 0;
#var hb_dest nil;
#var hb_paused 0;
#var hb_requested 0;
#var hb_info nil;
#var hb_rotate_location nil;
#var hb_rotate_location_count 0;
#var hb_robber_count 0;
#var hb_need_kill 1;

#var HB_GPS_WEIGHT "1,1,1,-1,-1,1,-1,-1";

@mapcreate{robber_score};
@mapset{robber_score;gaibang;9};
@mapset{robber_score;wudang;8};
@mapset{robber_score;taohua;7};
@mapset{robber_score;xingxiu;6};
@mapset{robber_score;huashan;5};
@mapset{robber_score;shaolin;4};
@mapset{robber_score;quanzhen;3};

#function {should_accept_quest} {
    #var hb_owner_loc @getenv{hb_owner_loc};
    #if {@ismember{%1;hb_blacklist:${hb_owner_loc}} != 0} {
        #return 0;
    };
    #if {"${xy_info}" == "on" && @ismember{%1;hb_blacklist_baowei:${hb_owner_loc}} != 0} {
        #return 0;
    };
    #return 1;
};

#alias {hb.watchdog.kick} {
    #delay {hb_check_delay} {
        hb.run;
    } {60};
};

#alias {hb.watchdog.stop} {
    #undelay {hb_check_delay};
};

#alias {hb.spec} {
    #alias tmp_hb_spec #cr;
    #alias tmp_hb_spec %1;
    tmp_hb_spec;
};

#alias {hb.teardown} {
    hb.watchdog.stop;
    #var quest nil;
    #var hb_robber_count 0;
    #class hb_setup_inner kill;
    #unticker {hb_ticker};
    set brief 2;
};

#alias {hb.traverse} {
    #alias {auto_pp_done} {
        #var gps_traverse_location %%0;
        #alias {gps_check_room_done} {
            #if {${gps.roomno} == -1} {
                #delay {1} {
                    notify ÂΩìÂâçÊàøÈó¥Êú™ËÆ∞ÂΩï, Êó†Ê≥ïÈÅçÂéÜ‰ºôËÆ°;
                };
            };
            #else {
                INVOKE gps.traverse ${gps.roomno} "${gps_traverse_location}" "dfs";
                #var hb_path ${gps_path};
                #var hb_path_index 1;
                #list hb_path size hb_path_size;
                #var hb_paused 0;
                #if {${hb_path_size} == 0} {
                    #if {"${pos.room}" == "${gps_traverse_location}"} {
                        hb.back_and_forth;
                    };
                    #else {
                        notify Êó†Ê≥ïÈÅçÂéÜ‰ºôËÆ° @ ${gps_traverse_location};
                    };
                };
                #else {
                    hb.run;
                };
            };
        };
        #if {"${gps_traverse_location}" == "nil"} {
            show_to_info ‰ºôËÆ°‰∏çÂ≠òÂú®;
            hb.b;
        };
        #else {
            gps.check_room {
                gps_check_room_done;
            };
        };
    };

    autopp {
        auto_pp_done;
    };
};

#alias {hb.run} {
    hb.watchdog.kick;
    #list hb_path get ${hb_path_index} hb_next_step;
    #if {@startwith{${hb_next_step};gps}} {
        #replace {hb_next_step} {gps} {hb};
    };
    #elseif {@ismember{${hb_next_step};directions} != 0} {
        #var hb_next_step gan che to ${hb_next_step};
    };
    #else {
        #var hb_next_step hb.command ${hb_next_step};
    };

    #if {${qx_percent} < 30 || ${js_percent} < 30 || ${nl_percent} < 10} {
        hb.pause;
        #delay {hb_move} {
            on_truce {
                on_health {hb.resume};
            };
        } {3};
    };
    #else {
        #if {${hb_path_index} > ${hb_path_size}} {
            hb.pause;
            #delay {hb_move} {
                #if {"@getenv{hb_state}" == "STARTED"} {
                    @setenv{hb_state;TRAVERSE};
                };
                #if {"@getenv{hb_state}" == "STARTED" || "@getenv{hb_state}" == "TRAVERSE"} {
                    hb.resume;
                };
            } {5};
        };
        #else {
            hb.before_move;
            #delay {hb_move} {
                #if {${hb_paused} == 0} {
                    ${hb_next_step};
                };
            } {3};
        };
    };
};

#alias {hb.before_move} {
    #if {${eff_qx_percent} < 95} {
        #2 yun heal;
    };
    #if {${eff_qx_percent} < 50} {
        #2 yun lifeheal ${char_id};
    };
    #if {${eff_js_percent} < 95} {
        #2 yun inspire;
    };
};

#var hb_retry_count 0;
#alias {hb.setup} {
    set brief 1;
    #var quest hb;
    #var hb_remaining_path_size ${hb_max_path_size};
    #var hb_path_index 1;
    #class hb_setup_inner open;
    #action {‰Ω†Â∑≤ÁªèÂú®Êñ∞ÊâãÈïñÂ±ÄËé∑ÂæóË∂≥Â§üÁªèÈ™å‰∫ÜÔºåÂø´Âà∞Â§ßÂüéÂ∏ÇÂéªÈóØËç°‰∏ÄÁï™Âêß„ÄÇ} {
        show_to_info Â∑≤ÁªèÂú®Êñ∞ÊâãÈïñÂ±ÄËé∑ÂæóË∂≥Â§üÁªèÈ™å;
        hb.stop;
    };

    #alias {hb.guohe} {
        #class guohe.inner open;
        #ticker {sw/yell_boat} {
            yell boat;
        } {5};
        #action {Ê≠£Á≠âÁùÄ‰Ω†Âë¢Ôºå‰∏äÊù•Âêß„ÄÇ} {
            gan che to enter;
        };
        #action {ËâÑÂÖ¨Â∞Ü‰∏ÄÂùóË∏èËÑöÊùøÊê≠‰∏äÂ†§Â≤∏Ôºå} {
            gan che to enter;
        };
        #alias {shangchuan} {
            #unticker {sw/yell_boat};
            #action {ÊâÄÊúâ‰∫∫Ë¢´Ëµ∂‰∏ã‰∫ÜÊ∏°Ëàπ} {
                #unaction {ÊâÄÊúâ‰∫∫Ë¢´Ëµ∂‰∏ã‰∫ÜÊ∏°Ëàπ};
                #class guohe.inner kill;
                #math hb_path_index ${hb_path_index}+1;
                #var hb_paused 0;
                hb.run;
            };
        };
        #action {^ÈªÑÊ≤≥Ê∏°Ëàπ$} {
            shangchuan;
        };
        #action {^ÈïøÊ±üÊ∏°Ëàπ$} {
            shangchuan;
        };
        #class guohe.inner close;

        hb.pause;
        ask shao gong about huanghe;
        ask shao gong about jiang;
    };

    #alias {hb.command} {
        #var hb_command %%0;
        ${hb_command};
        #math hb_path_index ${hb_path_index}+1;
        hb.run;
    };

    #alias {hb.delay} {
        #var gps_delay 1.5;
        #var gps_delay %1;
        #delay {${gps_delay}} {
            #math hb_path_index ${hb_path_index}+1;
            hb.run;
        };
    };

    #alias {hb.busy} {
        on_unbusy {
            #math hb_path_index ${hb_path_index}+1;
            hb.run;
        };
    };

    #alias hb.clear hb.force_clear;
    #alias {hb.force_clear} {
        #var hb_tmp_blocker %%0;
        #class clear_blocker.inner open;
        #action {‰Ω†ÊÉ≥ÊùÄË∞Å} {
            #class clear_blocker.inner kill;
            #math hb_path_index ${hb_path_index}+1;
            hb.run;
        };
        #ticker {tmp_blocker_ticker_kill} {
            killall ${hb_tmp_blocker};
        } {5};
        #class clear_blocker.inner close;

        killall ${hb_tmp_blocker};
    };

    #action {ÁúãÊù•ËØ•ÊâæÊú∫‰ºöÈÄÉË∑ë‰∫Ü} {
        hb.pause;
        show_to_tuiche ‰∏¢Èïñ;
        notify ‰∏¢Èïñ;
        hb.teardown;
        hb.b;
    };

    #action {^ÊÖ¢ÊÖ¢Âú∞‰Ω†Áªà‰∫éÂèàÊúâ‰∫ÜÁü•Ëßâ....} {
        show_to_tuiche ÊåÇ‰∫Ü;
        notify ÊåÇ‰∫Ü;
        hb.teardown;
        hb.b;
    };

    #action {^‰Ω†ÁöÑÁúºÂâç‰∏ÄÈªëÔºåÊé•Ëëó‰ªÄ‰πà‰πü‰∏çÁü•ÈÅì‰∫Ü} {
        hb.pause;
    };

    #action {„ÄéÂä´Âå™%*Ê∞îË°Ä%*„Äè} {
        #nop #var hb_retry_count 0;
        #cr;
    } {1};

    #action {‰Ω†ÊÉ≥ÊùÄË∞ÅÔºü} {
        hb.retry;
    };

    #action {ÈïñËΩ¶ËøòÊ≤°ÊúâË∑ü‰∏äÊù•Âë¢,Ëµ∞ÊÖ¢ÁÇπ.} {
        hb.retry;
    };

    #alias {hb.maybe_kill} {
        #math hb_retry_count ${hb_retry_count}+1;
        #if {${hb_retry_count} > 10} {
            #var hb_retry_count 0;
            killall;
        };
    };

    #action {‰Ω†ËøòÊòØÂÖàÊääÂØπÊâãËß£ÂÜ≥‰∫ÜÂÜçËØ¥Âêß} {
        hb.maybe_kill;
        hb.retry;
    } {1};

    #action {ÈïñËΩ¶ÂëºÂï¶‰∏ÄÂ£∞Êï£‰∫ÜÊû∂} {
        hb.pause;
        notify ÈïñËΩ¶ÂëºÂï¶‰∏ÄÂ£∞Êï£‰∫ÜÊû∂;
        hb.b;
    };

    #action {busy_for_move} {
        hb.retry;
    };

    #action {^‰Ω†Ëµ∂ÁùÄÈïñËΩ¶È©∂‰∫ÜËøáÊù•„ÄÇ$} {
        #var hb_retry_count 0;
        #if {${hb_paused} == 0} {
            #math hb_path_index ${hb_path_index}+1;
            hb.run;
        };
    };

    #action {Âä´Âå™‰∏™Ëµ∑Á∫µÈÅÅÂÖ•ÊöóÈáå‰∏çËßÅ‰∫Ü} {
        hb.detect_enemy;
        hb.retry;
    };

    #action {^Ëøô‰∏™ÊñπÂêë} {
        #if {${hb_paused} == 0} {
            hb.pause;
            hb.resume;
        };
    };

    #action {Âä´Âå™Ë∂Å‰Ω†‰∏çÊ≥®ÊÑèÔºåÊé®ÁùÄÈïñËΩ¶Â∞±Ë∑ëÔºå‰Ω†Ëµ∂Á¥ßËøΩ‰∫Ü‰∏äÂéª„ÄÇ} {
        hb.pause;
        @setenv{hb_mixin_lunci;6};
        #delay {hb_delay} {
            hb.resume;
        } {3};
    };

    #action {Âä´Âå™‰º∏Êâã‰∏ÄÊã¶ÈÅì} {
        war;
        hb.maybe_kill;
        hb.retry;
    } {1};

    #action {‰Ω†ÈïøÁ¨ë‰∏ÄÂ£∞ÔºåÂºÄÂßãÂØπÂë®Âõ¥‰ºó‰∫∫Áóõ‰∏ãÊùÄÊâãÔºÅ} {
        #var hb_need_kill 0;
    };

    #action {Âä´Âå™Á™ÅÁÑ∂‰ªéÊöóÂ§ÑË∑≥‰∫ÜÂá∫Êù•} {
        hb.detect_enemy;
        #if {${hb_need_kill} == 1} {
            killall robber;
        };
        #else {
            war;
        };
    };

    #action {Âõ¥‰∏äÊù•Âá†‰∏™‰ºôËÆ°Â∞ÜÈïñËΩ¶Êãâ‰∫ÜËøõÂéª} {
        @setenv{hb_state;ENDED};
        hb.pause;
        raw;
        show_to_tuiche ‰ªªÂä°ÂÆåÊàê;
        hb.teardown;

        #alias {on_taopao_done} {
            #if {@getenv{hb_lunci} == @getenv{hb_mixin_lunci}} {
                @setenv{hb_lunci;0};
                chain hb.p hb.back fullme hb.d;
            };
            #else {
                hb.b;
            };
        };

        taopao {
            on_taopao_done;
        };
    } {1};

    #class hb_setup_inner close;

    #var hb_elapsed_time 0;
    #ticker {hb_ticker} {
        #math hb_elapsed_time ${hb_elapsed_time}+1;
        show_to_tuiche ${hb_info} --> ${hb_elapsed_time}:00;
    } {60};
};

#alias {hb.retry} {
    #if {${hb_paused} == 0} {
        #delay {hb_move} {
            hb.run;
        } {3};
    };
};

#alias {hb.pause} {
    hb.watchdog.stop;
    #var hb_paused 1;
    #undelay {hb_move};
};

#alias {hb.get_owner} {
    #alias tmp_hb_get_owner #cr;
    #alias tmp_hb_get_owner %1;

    #alias {get_pos_done} {
        @setenv{hb_owner_loc;${pos.room}};
        #if {"${pos.room}" == "ÊòåÈöÜÈïñÂ±Ä"} {
            @setenv{hb_owner;zuo erba};
        };
        #elseif {"${pos.room}" == "ËçÜË•øÈïñÂ±Ä"} {
            @setenv{hb_owner;zhang zhi};
        };
        #elseif {"${pos.room}" == "È£ûËôéÈïñÂ±Ä"} {
            @setenv{hb_owner;chu daye};
        };
        #elseif {"${pos.room}" == "Â§©Á¶èÈïñÂ±Ä"} {
            @setenv{hb_owner;wang xiaoyue};
        };
        #else {
            @setenv{hb_owner;nil};
            @setenv{hb_owner_loc;nil};
        };
        tmp_hb_get_owner;
    };
    get_pos {
        get_pos_done;
    };
};

#alias {hb.d} {
    #var hb_state @getenv{hb_state};
    #if {"${hb_state}" == "GOT_CAIWU"} {
        give cai wu to @getenv{hb_owner};
    };
    #elseif {"${hb_state}" == "ENDED"} {
        ask @getenv{hb_owner} about finish;
    };
    #elseif {"${hb_state}" == "GOT_MIXIN"} {
        give mixin to @getenv{hb_owner};
        xian mixin;
    };
    #elseif {"${hb_state}" == "nil"} {
        show_to_info Ê≤°ÊúâÊé®ËΩ¶‰ªªÂä°;
    };
    #else {
        hb.f;
        #if {${hb_auto} == 1} {
            hb.start;
        };
    };
};

#alias {hb.q} {
    #var getesc_current_id 0;
    #if {"@getenv{hb_state}" == "nil"} {
        #if {"%1" != ""} {
            getesc %1;
        };
        #else {
            #ticker {hb_q_ticker} {
                listesc;
            } {5};
        };
    };
};

#alias {hb.f} {
    @setenv{hb_lunci;0};
    @setenv{hb_lunci_total;0};
    @setenv{hb_state;nil};
    @setenv{hb_mixin_lunci;6};
    hb.teardown;
    ask @getenv{hb_owner} about fail;
};

#alias {hb.b} {
    hb.teardown;
    gt @getenv{hb_owner_loc};
    on_there {
        hb.d;
    };
};

#alias {hb.back} {
    #alias tmp_hb_back #cr;
    #alias tmp_hb_back %1;
    gt @getenv{hb_owner_loc};
    on_there {
        tmp_hb_back;
    };
};

#alias {hb.start} {
    log.start;
    set_last_quest hb;
    set brief 2;
    #var hb_auto 1;
    #action {ËΩ¨Â§¥ÂØπ‰Ω†ÈÅìÔºö„ÄåËæõËã¶‰∫ÜÔºåÊúâÂá†‰∏§Èì∂Â≠êÁï•Ë°®ÂøÉÊÑèÔºåÂ∑≤ÁªèÂê©Âíê‰∫∫Â≠òÂÖ•‰Ω†ÁöÑÈí±Â∫ÑË¥¶Êà∑„ÄÇ„Äç} {
        #if {"@getenv{hb_state}" == "ENDED"} {
            @setenv{hb_state;nil};
            #delay {hb_auto_delay} {
                #if {${hb_auto} == 1} {
                    hb.restart;
                };
            } {3};
        };
    };

    #action {ÈÄíÁªô‰Ω†‰∏ÄÂ∞ÅÂØÜ‰ø°} {
        @setenv{hb_state;GOT_MIXIN};
        @setenv{hb_lunci_total;@eval{@getenv{hb_lunci_total}+1}};
        @setenv{hb_lunci;0};
        show_to_tuiche ÂØÜ‰ø°;
        xian mixin;
    };

    #action {‰Ω†Áªô%*‰∏Ä‰∫õÂ§±Ë∏™ÁöÑË¥¢Áâ©} {
        show_to_tuiche ÂØÜ‰ø°ÂÆåÊàê;
        @setenv{hb_state;nil};
        @setenv{hb_mixin_lunci;5};
        #delay {hb_auto_delay} {
            #if {${hb_auto} == 1} {
                hb.restart;
            };
        } {3};
    };

    #class hb.auto.inner open;
    #alias {on_severe_wound} {
        keyao {
            hb.b;
        };
    } {1};

    #action {^‰Ω†‰∏çÊòØÊâçË¶Å‰∫Ü‰ªªÂä°Âêó} {
        hb.f;
        hb.restart;
    };

    #action {‰Ω†‰∏ÄÂÖ±Ë¢´Â•ñÂä±‰∫ÜÔºö} {
        #class tmp.inner open;
        #action {%*ÁÇπÁªèÈ™åÔºõ} {
            #class tmp.inner kill;
            show_to_info @ctd{%%%1} ÁÇπÁªèÈ™å;
        };
     #class tmp.inner close;
    };

    #action {${char_name}Â∏Æ%*ËøΩÂõûË¥¢Áâ©ÔºåÈ¢ùÂ§ñËé∑Âæó%*ÁÇπÁªèÈ™å} {
        show_to_info È¢ùÂ§ñËé∑Âæó @ctd{%%2} ÁÇπÁªèÈ™å;
    };

    #alias {got_gem} {
        #action {‰Ω†Â∞ÜÊâã‰∏≠%*{‚óé|‚òÜ|‚òÖ}%*ÊîæËøõ‰∫ÜÂÆùÁü≥Ë¢ã} {
            gem.record %%%1 %%%2 %%%3;
        };
        pack gem;
        #delay {pack_gem} {
            #unaction {‰Ω†Â∞ÜÊâã‰∏≠%*{‚óé|‚òÜ|‚òÖ}%*ÊîæËøõ‰∫ÜÂÆùÁü≥Ë¢ã};
        } {3};
    };

    #action {ÂìáÔºå‰Ω†Â§™ÂéâÂÆ≥‰∫ÜÔºåËøô‰πàÂø´Â∞±ÊääËøô‰∫õË¥¢Áâ©ËøΩÂõûÔºåÊàëÊúâÈáçË∞¢ÔºÅ} {
        got_gem;
    };

    #action {Êéâ‰∫ÜÂá∫Êù•‰∏ÄÈ¢ó} {
        got_gem;
    };

    #action {%d%s%S%s%S%sÂæÖËÆ§È¢Ü} {
        #var getesc_id %%1;
        #var getesc_address %%3;
        #if {${getesc_current_id} == 0 && @should_accept_quest{${getesc_address}} == 1} {
            #var getesc_current_id ${getesc_id};
            #var getesc_current_address ${getesc_address};
        };
    };

    #action {Êù•ËÆ§È¢ÜÊäºÈïñ‰ªªÂä°} {
        #var hb_state @getenv{hb_state};
        #if {"${hb_state}" == "nil"} {
            #if {${getesc_current_id} != 0} {
                #var hb_rotate_location_count 0;
                hb.q ${getesc_current_id};
            };
            #else {
                #math hb_rotate_location_count ${hb_rotate_location_count} + 1;
                #if {${hb_rotate} == 1 && ${hb_rotate_location_count} > 3 && "${hb_rotate_location}" != "nil"} {
                    #var hb_rotate_location_count 0;
                    gt ${hb_rotate_location};
                    on_there {
                        hb.restart;
                    };
                };
            };
        };
    };

    #action {%*Âêë%*ÊâìÂê¨ÊúâÂÖ≥%*ÁöÑÊ∂àÊÅØ} {
        #if {"%%1" == "‰Ω†"} {
            #var hb_requested 1;
        };
        #else {
            #var hb_requested 0;
        };
    };

    #action {%*ËØ¥ÈÅìÔºö„ÄåÈïñËΩ¶Ê≤°ÊúâÈÄÅÂà∞Âú∞Â§¥ÔºåËé´ÈùûÊòØ‰Ω†Âêû‰∫ÜÔºÅÔºü„Äç} {
        #if {${hb_requested} == 1} {
            hb.f;
            hb.start;
        };
    } {1};

    #action {${char_name}ÊääËøôÊâπÁ∫¢Ë¥ßÈÄÅÂà∞%*‰ªñÂ∑≤ÁªèÊ¥æ‰∫Ü‰∏™‰ºôËÆ°ÂêçÂè´%*Âà∞%*ÈôÑËøëÊé•‰Ω†} {
        #unticker {hb_q_ticker};
        @setenv{hb_state;STARTED};
        @setenv{hb_lunci;@eval{@getenv{hb_lunci}+1}};
        @setenv{hb_huoji;%%2};
        #nop INVOKE gps.get_area %%1;
        #nop #var hb_dest ${gps.area}%%3;
        #var hb_dest ${getesc_current_address};
        @setenv{hb_dest;${hb_dest}};
        #var hb_info %%2|${hb_dest};
        @setenv{hb_info;${hb_info}};
        show_to_tuiche ${hb_info};
        autopp.set %%2;
        hb.setup;
        hb.resume;
    } {1};

    #class hb.auto.inner close;

    @declarenv{hb_state;nil};
    @declarenv{hb_mixin_lunci;6};
    @declarenv{hb_lunci;0};
    @declarenv{hb_lunci_total;0};

    #var hb_state @getenv{hb_state};
    #var hb_location %1;
    #if {"${hb_location}" == ""} {
        #var hb_location @getenv{hb_owner_loc};
    };
    #if {"${hb_state}" == "STARTED" || "${hb_state}" == "TRAVERSE" } {
        #var hb_huoji @getenv{hb_huoji};
        #var hb_dest @getenv{hb_dest};
        #var hb_info @getenv{hb_info};
        #if {"${hb_huoji}" == "nil" || "${hb_dest}" == "nil"} {
            show_to_info Êé®ËΩ¶Â§±Ë¥•;
            hb.f;
        };
        #else {
            show_to_info ÁªßÁª≠Êé®ËΩ¶;
            show_to_tuiche ${hb_info};
            autopp.set ${hb_huoji};
            #var hb_remaining_path_size 0;
            hb.setup;
            #delay {hb_delay} {
                hb.resume;
            } {5};
        };
    };
    #elseif {"${hb_state}" == "GOT_MIXIN"} {
        notify ÊúâÂØÜ‰ø°;
    };
    #elseif {"${hb_state}" == "nil"} {
        #if {"${hb_location}" == "nil"} {
            show_to_info ËØ∑ÊåáÂÆöÈïñÂ±Ä: zz, zuo, tf, fh, fm;
            hb.stop;
        };
        #else {
            chain fullme hb.p {gt ${hb_location};on_there {hb.get_owner {hb.restart;};};};
        };
    };
    #else {
        chain fullme hb.b;
    };
};

#alias {hb.restart} {
    drop_garbage;
    #math next_lunci @getenv{hb_lunci}+1;
    show_to_tuiche ÂáÜÂ§á;
    on_health {hb.q};
};

#alias {hb.stop} {
    log.stop;
    unset_last_quest;
    #var hb_auto 0;
    health.cancel;
    hb.teardown;
    #class hb.auto.inner kill;
    #undelay {hb_auto_delay};
    #unticker {hb_q_ticker};
    #unticker {hb_ticker};
    @clearenv{hb_dest};
    @clearenv{hb_huoji};
    @clearenv{hb_info};
    @clearenv{hb_owner};
    @clearenv{hb_state};
    show_to_tuiche Êé®ËΩ¶ÁªìÊùü;
};

#alias {mx} {
    chain on_there mx.q;
    gt %1;
};

#alias {mx.q} {
    #class mx.inner open;
    #ticker {mx_q} {
        zhaoxun;
    } {5};
    #action {‰Ω†ÊâØÂºÄÂóìÂ≠êÔºåÂºÄÂßãÂ§ßÂñäÔºöÂ∞èÁéãÂÖ´ËõãÔºå‰Ω†ÁªôÊàëÊªöÂá∫Êù•} {
        #class mx.inner kill;
        notify ÂØÜ‰ø°Âú∞ÁÇπ‰∏çÂØπ;
    };
    #action {‰∏Ä‰∏™‰ºôËÆ°ÊåñÁùÄÈºªÂ±éËµ∞‰∫ÜÂá∫Êù•ÔºåÈÅìÔºö‰Ω†ÊâæÊàëÂï•‰∫ã} {
        #unticker {mx_q};
        #delay {3} {
            gps.traverse Ë¥¢Áâ©ÁöÑ‰ºôËÆ° bfs;
        };
    };
    #action {GPS: ÈÅçÂéÜÂÆåÊàê} {
        #class mx.inner kill;
        notify Ê≤°ÊâæÂà∞‰ºôËÆ°;
    };
    #action {ÊâæÂà∞ÁõÆÊ†á} {
        mx.check;
    };
    #alias {mx.got_caiwu} {
        @setenv{hb_state;GOT_CAIWU};
        show_to_tuiche ÊãøÂà∞Ë¥¢ÂÆù;
        play get_item.wav;
        #class mx.inner kill;
        hb.b;
    };
    #alias {mx.check} {
        l;
        #class mx.inner open;
        #action {Ë¥¢Áâ©ÁöÑ‰ºôËÆ° %S(%S)} {
            #format {tmp_huoji} {%l} {%%%2};
            #class mx.inner open;
            #action {Êää‰∏ÄÂåÖË¥¢Áâ©Á†∏Âêë‰Ω†Ôºå‰∏ÄËΩ¨Áúº‰∏çËßÅ‰∫Ü„ÄÇ} {
                #undelay {mx_delay};
                mx.got_caiwu;
            };
            #delay {mx_delay} {
                mx.got_caiwu;
            } {10};
            #ticker {yao} {
                ask $tmp_huoji about yao;
            } {1};
            #class mx.inner close;
        } {1};
        #class mx.inner close;
    };

    #class mx.inner close;
    zhaoxun;
};

#alias {hb.p} {
    #alias tmp_hb_p #cr;
    #alias tmp_hb_p %1;
    show_to_tuiche ÂáÜÂ§á;
    #var chain_action_hb_p sell.all get.qian get.san get.bao jianding.all donate.all repair special_repair gem.combine hb.spec tmp_hb_p;
    #if {${need_reload} == 1} {
        #var chain_action_hb_p reload ${chain_action_hb_p};
    };
    chain ${chain_action_hb_p};
};

#alias {show_to_tuiche} {
    show_to_quest Êé®ËΩ¶: @getenv{hb_lunci_total}+@getenv{hb_lunci}: %0;
};

#alias {hb.check_robber} {
    #delay {detect_enemy_delay} {
        #var hb_robber_count ${tmp_robber_count};
        #class detect_enemy.inner kill;
    } {1};
    #math tmp_robber_count ${tmp_robber_count}+1;
    #var tmp_score @mapget{robber_score;%1};
    #if {${tmp_score} > ${robber_score}} {
        #var robber_score ${tmp_score};
        #var enemy_menpai %1;
        #var enemy ${char_id}'s robber ${tmp_robber_count};
    };
};

#alias {hb.resume} {
    #var hb_state @getenv{hb_state};
    #if {"${hb_state}" == "STARTED"} {
        hb.goto_dest_area;
    };
    #elseif {"${hb_state}" == "TRAVERSE"} {
        hb.traverse;
    };
};

#alias {hb.back_and_forth} {
    #alias {get_pos_done} {
        #list exits_list create ${exits_list};
        #var back_exit ${exits_list}[1];
        #list hb_path create {${back_exit};@opposite{${back_exit}}};
        #var hb_path_index 1;
        #list hb_path size hb_path_size;
        hb.run;
    };
    get_pos {
        get_pos_done;
    };
};

#alias {hb.goto_dest_area} {
    #var hb_paused 0;
    #alias {gps_check_room_done} {
        #if {${gps.roomno} == -1} {
            #delay {1} {
                #show {GPS: ÂΩìÂâçÊàøÈó¥Êú™ËÆ∞ÂΩï, Êó†Ê≥ïË°åËµ∞};
            };
        };
        #else {
            #math hb_remaining_path_size ${hb_remaining_path_size}-${hb_path_index};
            #var gps.from_roomno ${gps.roomno};
            INVOKE gps.get_room ${hb_dest};
            #if {${gps.from_roomno} == ${gps.roomno}} {
                hb.back_and_forth;
                #return;
            };
            INVOKE gps.get_path ${gps.from_roomno} ${gps.roomno} ${HB_GPS_WEIGHT};
            #var hb_path ${gps_path};
            #var hb_path_index 1;
            #list hb_path size hb_path_size;
            #if {${hb_path_size} == 0} {
                #show {GPS: ÁõÆÊ†áÊàøÈó¥‰∏çÂèØËææ, Êó†Ê≥ïË°åËµ∞: ${hb_dest}:${gps.roomno}};
                #return;
            };
            #if {@getenv{hb_mixin_lunci} == 5} {
                #math additional_path_size ${hb_remaining_path_size} - ${hb_path_size};
                #if {${additional_path_size} > 0} {
                    #list hb_path get 3 first_step;
                    #var second_step @opposite{${first_step}};
                    #if {"${second_step}" != "nil"} {
                        #var cnt 0;
                        #while {${cnt} < ${additional_path_size}} {
                            #list hb_path insert 3 ${second_step};
                            #list hb_path insert 3 ${first_step};
                            #math cnt $cnt+2;
                        };
                    };
                    #list hb_path size hb_path_size;
                };
            };
            hb.run;
        };
    };
    gps.check_room {
        gps_check_room_done;
    };
};

#alias {hb.detect_enemy} {
    #class detect_enemy.inner open;
    #action {~‰Ω†ÊÉ≥Ë¶ÅÊî∂[1;31mÂä´Âå™[2;37;0m‰∏∫ÂºüÂ≠ê} {
        hb.check_robber quanzhen;
    };
    #action {~‰Ω†ÊÉ≥Ë¶ÅÊî∂[1;32mÂä´Âå™[2;37;0m‰∏∫ÂºüÂ≠ê} {
        hb.check_robber shaolin;
    };
    #action {~‰Ω†ÊÉ≥Ë¶ÅÊî∂[1;33mÂä´Âå™[2;37;0m‰∏∫ÂºüÂ≠ê} {
        hb.check_robber gaibang;
    };
    #action {~‰Ω†ÊÉ≥Ë¶ÅÊî∂[1;34mÂä´Âå™[2;37;0m‰∏∫ÂºüÂ≠ê} {
        hb.check_robber xingxiu;
    };
    #action {~‰Ω†ÊÉ≥Ë¶ÅÊî∂[1;35mÂä´Âå™[2;37;0m‰∏∫ÂºüÂ≠ê} {
        hb.check_robber huashan;
    };
    #action {~‰Ω†ÊÉ≥Ë¶ÅÊî∂[1;36mÂä´Âå™[2;37;0m‰∏∫ÂºüÂ≠ê} {
        hb.check_robber taohua;
    };
    #action {~‰Ω†ÊÉ≥Ë¶ÅÊî∂[1;37mÂä´Âå™[2;37;0m‰∏∫ÂºüÂ≠ê} {
        hb.check_robber wudang;
    };
    #class detect_enemy.inner close;

    #var enemy nil;
    #var tmp_robber_count 0;
    #var hb_robber_count 0;
    #var robber_score 0;
    shou ${char_id}'s robber 1;
    shou ${char_id}'s robber 2;
    shou ${char_id}'s robber 3;
    shou ${char_id}'s robber 4;
    #nop ]]]]]]]]]]]]]];
};

#list hb_blacklist_baowei:ËçÜË•øÈïñÂ±Ä create {
    Ê≠¶ÂΩì‰∏âÊ∏ÖÊÆø;Â∞ëÊûó‰ΩõÂøÉ‰∫ï;Êâ¨Â∑ûÈÜâ‰ªôÊ•º;Ë•ÑÈò≥ÂΩìÈì∫;
};

#list hb_blacklist:ËçÜË•øÈïñÂ±Ä create {
    ÂÖ®ÁúüÂ§©Â∞äËÆ≤ÁªèÂ†Ç;
};

#list hb_blacklist:È£ûÈ©¨ÈïñÂ±Ä create {
    ÊôãÈò≥ËêßÂ∫ú;ÊàêÈÉΩÂΩìÈì∫;ËµûÊôÆÊù•Á¶èÊùÇË¥ß;Â§ßÁêÜÂ§™ÂíåÂ±Ö;Ê≠¶ÂΩìËçÜË•øÈïñÂ±Ä;ÊòÜÊòéÁ•ûÂ®ÅÈïñÂ±Ä;ÂÖ®ÁúüÂ§©Â∞äËÆ≤ÁªèÂ†Ç;
};

#list hb_blacklist_baowei:È£ûÈ©¨ÈïñÂ±Ä create {
    Ë•ÑÈò≥ÂΩìÈì∫;Ê≠¶ÂΩìËçÜË•øÈïñÂ±Ä;
};

#list hb_blacklist:È£ûËôéÈïñÂ±Ä create {
    ÊôãÈò≥ËêßÂ∫ú;ËµûÊôÆÊù•Á¶èÊùÇË¥ß;
};

#list hb_blacklist_baowei:È£ûËôéÈïñÂ±Ä create {
    Ê≠¶ÂΩìËçÜË•øÈïñÂ±Ä;
};

#list hb_blacklist:Â§©Á¶èÈïñÂ±Ä create {
    ÈïøÂÆâÈ£ûÈ©¨ÈïñÂ±Ä;ËµûÊôÆÊù•Á¶èÊùÇË¥ß;Â≥®ÂµãÊØóÂç¢ÊÆø;
};

#list hb_blacklist_baowei:Â§©Á¶èÈïñÂ±Ä create {
    Ê≠¶ÂΩìËçÜË•øÈïñÂ±Ä;Ë•ÑÈò≥ÂΩìÈì∫;
};

#list hb_blacklist:ÊòåÈöÜÈïñÂ±Ä create {
    ÂΩí‰∫ëÂ∫ÑÂ§™ÊπñË°ó;Â≥®ÂµãÊØóÂç¢ÊÆø;ËãèÂ∑ûËÅöÂÆùÊñã;
};

#class hubiao close
